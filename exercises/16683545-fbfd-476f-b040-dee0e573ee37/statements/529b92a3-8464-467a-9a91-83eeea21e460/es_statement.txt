<p>En una tabla, es posible <strong>insertar valores que se obtienen directamente del resultado de una consulta.</strong></p><p><img alt="" src="https://ikastaroak.birt.eus/edu/argitalpen/backupa/20200331/1920k/es/DAMDAW/BD/BD06/es_DAMDAW_BD06_Contenidos/BD06_CONT_R31_INSERT_SELECT_miniatura.png" /></p><h3>Ejemplo</h3><p>Imaginemos que se va a realizar una reestructuraci&oacute;n de la empresa, de manera que los empleados del departamento <code>&#39;Public Relations&#39;</code> se van a integrar en el departamento <code>&#39;Sales&#39;</code>.</p><p>La informaci&oacute;n de los empleados que han estado vinculados al departamento <code>&quot;Public Relations&quot;</code> debe incorporarse a la tabla <code>job_history</code> antes de reasignarles el departamento <code>&#39;Sales&#39;</code>.</p><p>Comenzaremos realizando una consulta que busque la informaci&oacute;n de los empleados del departamento <code>&#39;Public Relations&#39;</code>:</p><blockquote><pre><code>SELECT EMPLOYEES.*<br />FROM EMPLOYEES JOIN DEPARTMENTS ON (EMPLOYEES.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID)<br />WHERE DEPARTMENT_NAME = &#39;Public Relations&#39;;</code><br /><br /> employee_id | first_name | last_name | email | phone_number |      hire_date      | job_id |  salary  | commission_pct | manager_id | department_id <br />-------------+------------+-----------+-------+--------------+---------------------+--------+----------+----------------+------------+---------------<br />         204 | Hermann    | Baer      | HBAER | 515.123.8888 | 1994-06-07 00:00:00 | PR_REP | 10000.00 |                |        101 |            70<br />(1 row)</pre></blockquote><p>A continuaci&oacute;n, debemos conocer qu&eacute; datos necesitamos incorporar a la tabla <code>job_history</code>, para adaptar la consulta anterior a los requisitos de la tabla <code>job_history</code>:</p><blockquote><pre><code>\d job_history</code><br /><br />                          Table "public.job_history"<br />    Column     |            Type             | Collation | Nullable | Default <br />---------------+-----------------------------+-----------+----------+---------<br /> employee_id   | integer                     |           | not null |<br /> start_date    | timestamp without time zone |           | not null |<br /> end_date      | timestamp without time zone |           | not null | <br /> job_id        | character varying(10)       |           | not null | <br /> department_id | integer                     |           |          | </pre></blockquote><p>De toda la informaci&oacute;n de los empleados del departamento <code>&#39;Public Relations&#39;</code> nos quedamos con la siguiente informaci&oacute;n:</p><blockquote><pre><code>SELECT EMPLOYEE_ID, HIRE_DATE, CURRENT_DATE, JOB_ID, EMPLOYEES.DEPARTMENT_ID<br />FROM EMPLOYEES JOIN DEPARTMENTS ON (EMPLOYEES.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID)<br />WHERE DEPARTMENT_NAME = &#39;Public Relations&#39;;</code><br /><br /> employee_id |      hire_date      | current_date | job_id | department_id <br />-------------+---------------------+--------------+--------+---------------<br />         204 | 1994-06-07 00:00:00 | 2022-08-31   | PR_REP |            70<br />(1 row)</pre></blockquote><p>Una vez que los datos resultantes de la sentencia cumplen con los requisitos de la tabla <code>job_history</code>, podemos utilizar esa consulta como origen de los datos que se van a utilizar en la inserci&oacute;n que debemos realizar en la tabla <code>job_history</code>.</p><blockquote><pre><code>BEGIN;<br /><br /><strong>INSERT INTO job_history<br />SELECT EMPLOYEE_ID, HIRE_DATE, CURRENT_DATE, JOB_ID, EMPLOYEES.DEPARTMENT_ID<br />FROM EMPLOYEES JOIN DEPARTMENTS ON (EMPLOYEES.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID)<br />WHERE DEPARTMENT_NAME = &#39;Public Relations&#39;;</strong><br />-- INSERT 0 1<br /><br />SELECT EMPLOYEE_ID, START_DATE, END_DATE, JOB_ID, JH.DEPARTMENT_ID<br />FROM JOB_HISTORY JH JOIN DEPARTMENTS ON (JH.DEPARTMENT_ID = DEPARTMENTS.DEPARTMENT_ID)<br />WHERE DEPARTMENT_NAME = &#39;Public Relations&#39;;<br />ROLLBACK;</code></pre></blockquote><h3>Ejercicio</h3><p>Vamos a crear departamentos diferentes para los gestores. Para ello, insertaremos, en la tabla <code>departments</code>, un registro por cada uno de los tipos de trabajo cuyo identificador finalice por <code>&#39;_MAN&#39;</code>, con los siguientes datos:</p><ul><li><code>DEPARTMENT_ID</code>: el que resulta de incrementar en 300 el <code>DEPARTMENT_ID</code> del empleado que se va a nombrar como manager del departamento.</li><li><code>DEPARTMENT_NAME</code>: el <code>JOB_TITLE</code> del tipo de trabajo que se est&aacute; insertando.</li><li><code>MANAGER_ID</code>: el menor identificador de empleado de entre los que tienen el tipo de trabajo que se est&aacute; insertando.</li><li><code>LOCATION_ID</code>: el valor constante 1700</li></ul>